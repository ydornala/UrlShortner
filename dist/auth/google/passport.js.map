{"version":3,"sources":["auth/google/passport.js"],"names":["setup","User","config","passport","use","GoogleStrategy","clientID","google","clientSecret","callbackURL","accessToken","refreshToken","profile","done","findOne","id","exec","then","user","name","displayName","email","emails","value","username","split","provider","save","savedUser","catch","err"],"mappings":";;;;;;;;;AAAA;;AACA;;AAEO,SAASA,KAAT,CAAeC,IAAf,EAAqBC,MAArB,EAA6B;AAChCC,oBAASC,GAAT,CAAa,IAAIC,6BAAJ,CAAmB;AAC5BC,IAAAA,QAAQ,EAAEJ,MAAM,CAACK,MAAP,CAAcD,QADI;AAE5BE,IAAAA,YAAY,EAAEN,MAAM,CAACK,MAAP,CAAcC,YAFA;AAG5BC,IAAAA,WAAW,EAAEP,MAAM,CAACK,MAAP,CAAcE;AAHC,GAAnB,EAKb,UAASC,WAAT,EAAsBC,YAAtB,EAAoCC,OAApC,EAA6CC,IAA7C,EAAmD;AAC/CZ,IAAAA,IAAI,CAACa,OAAL,CAAa;AAAC,mBAAaF,OAAO,CAACG;AAAtB,KAAb,EAAwCC,IAAxC,GACKC,IADL,CACUC,IAAI,IAAI;AACV,UAAGA,IAAH,EAAS;AACL,eAAOL,IAAI,CAAC,IAAD,EAAOK,IAAP,CAAX;AACH;;AAEDA,MAAAA,IAAI,GAAG,IAAIjB,IAAJ,CAAS;AACZkB,QAAAA,IAAI,EAAEP,OAAO,CAACQ,WADF;AAEZC,QAAAA,KAAK,EAAET,OAAO,CAACU,MAAR,CAAe,CAAf,EAAkBC,KAFb;AAGZC,QAAAA,QAAQ,EAAEZ,OAAO,CAACU,MAAR,CAAe,CAAf,EAAkBC,KAAlB,CAAwBE,KAAxB,CAA8B,GAA9B,EAAmC,CAAnC,CAHE;AAIZC,QAAAA,QAAQ,EAAE,QAJE;AAKZnB,QAAAA,MAAM,EAAEK;AALI,OAAT,CAAP;AAOAM,MAAAA,IAAI,CAACS,IAAL,GACKV,IADL,CACUW,SAAS,IAAIf,IAAI,CAAC,IAAD,EAAOe,SAAP,CAD3B,EAEKC,KAFL,CAEWC,GAAG,IAAIjB,IAAI,CAACiB,GAAD,CAFtB;AAGH,KAhBL,EAiBKD,KAjBL,CAiBWC,GAAG,IAAIjB,IAAI,CAACiB,GAAD,CAjBtB;AAkBH,GAxBY,CAAb;AAyBH","sourcesContent":["import passport from 'passport';\nimport { Strategy as GoogleStrategy } from 'passport-google-oauth20';\n\nexport function setup(User, config) {\n    passport.use(new GoogleStrategy({\n        clientID: config.google.clientID,\n        clientSecret: config.google.clientSecret,\n        callbackURL: config.google.callbackURL\n    },\n    function(accessToken, refreshToken, profile, done) {\n        User.findOne({'google.id': profile.id}).exec()\n            .then(user => {\n                if(user) {\n                    return done(null, user);\n                }\n\n                user = new User({\n                    name: profile.displayName,\n                    email: profile.emails[0].value,\n                    username: profile.emails[0].value.split('@')[0],\n                    provider: 'google',\n                    google: profile\n                });\n                user.save()\n                    .then(savedUser => done(null, savedUser))\n                    .catch(err => done(err));\n            })\n            .catch(err => done(err));\n    }));\n}"],"file":"passport.js"}