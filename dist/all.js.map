{"version":3,"sources":["index.js","auth/auth.service.js","auth/index.js","auth/google/index.js","auth/google/passport.js","api/Code/code.controller.js","api/Code/index.js","api/Links/index.js","api/Links/link.controller.js","api/Links/link.model.js","api/User/User.controller.js","api/User/User.model.js","api/User/index.js","config/environment/development.js","config/environment/index.js","config/environment/production.js"],"names":["express","require","mongoose","config","bodyParser","SERVE_HOSTNAME","SERVE_PORT","cookieSession","uuid","v4","set","console","log","connect","mongo","uri","useNewUrlParser","then","catch","err","app","use","json","urlencoded","extended","name","keys","process","env","SESHSECRET","maxAge","req","res","next","method","url","session","id","header","default","listen","validateJwt","secret","secrets","isAuthenticated","query","hasOwnProperty","headers","authorization","access_token","cookies","token","User","findById","user","_id","exec","status","end","signToken","role","jwt","sign","expiresIn","setTokenCookie","send","cookie","redirect","router","Router","Config","setup","passport","get","authenticate","failureRedirect","scope","GoogleStrategy","clientID","google","clientSecret","callbackURL","accessToken","refreshToken","profile","done","findOne","displayName","email","emails","value","username","split","provider","_json","save","savedUser","index","Link","urlCode","params","code","linkFound","longUrl","error","controller","module","exports","post","create","respondWithResult","statusCode","entity","handleEntityNotFound","handleError","find","body","baseUrl","validUrl","isUri","shortid","generate","shortUrl","LinkSchema","Schema","String","timestamps","model","facebook","MONGOEB_URI","_","all","NODE_ENV","clientPort","CLIENT_PORT","port","PORT","GOOGLE_ID","GOOGLE_SECRET","DOMAIN","FACEBOOK_ID","FACEBOOK_SECRET","merge"],"mappings":"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","file":"all.js","sourcesContent":["const express = require('express');\nconst mongoose = require('mongoose');\nconst config = require('./config/environment');\nconst bodyParser = require('body-parser');\n\nconst { SERVE_HOSTNAME, SERVE_PORT } = require('../src/config.json');\nconst cookieSession = require('cookie-session');\nconst { v4: uuid } = require('uuid')\n// require('dotenv-safe').config({\n//   allowEmptyValues: true\n// });\n\nmongoose.set('useNewUrlParser', true);\nmongoose.set('useFindAndModify', false);\n\nconsole.log('conf', config);\n\nmongoose\n  .connect(\n    config.mongo.uri,\n    { useNewUrlParser: true }\n  )\n  .then(() => console.log('Connected to MongoDB'))\n  .catch(err => console.log('Failed to connect to MongoDB', err));\n\nconst app = express();\n\napp.use(bodyParser.json());\napp.use(bodyParser.urlencoded({ extended: true }));\n\napp.use(cookieSession({\n  name: 'shortlinks',\n  keys: [process.env.SESHSECRET],\n  maxAge: 30 * 24 * 60 * 60 * 1000 // 30 days\n}))\n\n\napp.use(function(req, res, next) {\n  console.log(`${req.method} ${req.url}`);\n  req.session.id = (req.session.id || uuid());\n  res.header('Access-Control-Allow-Origin', '*');\n  next(); // pass control to the next handler\n});\n\n\napp.use('/', require('./api/Code'));\napp.use('/api/links', require('./api/Links'));\napp.use('/auth', require('./auth').default);\n\napp.listen(\n  SERVE_PORT, \n  SERVE_HOSTNAME,\n  ()=> console.log(`Shortlinks backend listening on ${SERVE_HOSTNAME}:${SERVE_PORT}!`)\n)","import config from '../config/environment';\nimport jwt from 'jsonwebtoken';\nimport expressJwt from 'express-jwt';\nimport compose from 'composable-middleware';\nimport User from '../api/User/User.model';\n\nconst validateJwt = expressJwt({\n    secret: config.secrets.session\n});\n\nexport function isAuthenticated() {\n    return compose()\n        .use(function(req, res, next) {\n            if(req.query && req.query.hasOwnProperty('access_token')) {\n                req.headers.authorization = `Bearer ${req.query.access_token}`;\n            }\n\n            if(req.query && typeof req.headers.authorization === 'undefined') {\n                req.headers.authorization = `Bearer ${req.cookies.token}`;\n            }\n\n            validateJwt(req, res, next);\n        })\n        .use(function(req, res, next) {\n            User.findById(req.user._id).exec()\n                .then(user => {\n                    if(!user) {\n                        return res.status(401).end();\n                    }\n                    req.user = user;\n                    next();\n                    return null;\n                })\n                .catch(err => next(err));\n        });\n}\n\nexport function signToken(id, role) {\n    return jwt.sign({_id: id}, config.secrets.session, {\n        expiresIn: 60 * 60 * 5\n    });\n}\n\nexport function setTokenCookie(req, res) {\n    if(!req.user) {\n        return res.status(404).send('It looks like you aren\\'t logged in, please try again.');\n    }\n    var token = signToken(req.user._id, req.user.role);\n    res.cookie('token', token);\n    res.redirect('/');\n}","const express = require('express');\nconst User = require('../api/User/User.model');\nconst router = express.Router();\n\nconst Config = require('../config/environment');\n\nrequire('./google/passport').setup(User, Config);\n\nrouter.use('/google', require('./google').default);\n\nexport default router;","import { setTokenCookie } from '../auth.service';\nconst express = require('express');\nconst passport = require('passport');\n\nconst router = express.Router();\n\nrouter\n    .get('/', passport.authenticate('google', {\n     failureRedirect: '/register',\n     scope: ['profile',' email'],\n     session: true\n    }))\n    .get('/callback', passport.authenticate('google', {\n        failureRedirect: 'register',\n        session: true\n    }), setTokenCookie);\n\n    export default router;","import passport from 'passport';\nimport { Strategy as GoogleStrategy } from 'passport-google-oauth20';\n\nexport function setup(User, config) {\n    passport.use(new GoogleStrategy({\n        clientID: config.google.clientID,\n        clientSecret: config.google.clientSecret,\n        callbackURL: config.google.callbackURL\n    },\n    function(accessToken, refreshToken, profile, done) {\n        User.findOne({'google.id': profile.id}).exec()\n            .then(user => {\n                if(user) {\n                    return done(null, user);\n                }\n\n                user = new User({\n                    name: profile.displayName,\n                    email: profile.emails[0].value,\n                    username: profile.emails[0].value.split('@')[0],\n                    provider: 'google',\n                    google: profile._json\n                });\n                user.save()\n                    .then(savedUser => done(null, savedUser))\n                    .catch(err => done(err));\n            })\n            .catch(err => done(err));\n    }));\n}","import Link from '../Links/link.model';\n\nexport function index(req, res) {\n    try {\n        return Link.findOne({urlCode: req.params.code})\n            .then(linkFound => {\n                return res.redirect(linkFound.longUrl);\n            })\n            .catch(err => {\n                return res.status(404).json('No url found');\n            })\n    } catch (error) {\n        console.error(error);\n        res.status(500).json('Server error');\n    }\n}","var express = require('express');\nvar controller = require('./code.controller');\n\nvar router = express.Router();\n\nrouter.get('/:code', controller.index);\n\nmodule.exports = router;","var express = require('express');\nvar controller = require('./link.controller');\n\nvar router = express.Router();\n\nrouter.get('/', controller.index);\nrouter.post('/', controller.create);\n\nmodule.exports = router;","import Link from './link.model';\nimport shortid from 'shortid';\nimport validUrl from 'valid-url';\nimport config from 'config';\n\nfunction respondWithResult(res, statusCode) {\n    statusCode = statusCode || 200;\n    return function(entity) {\n        if(entity) {\n            return res.status(statusCode).json(entity);\n        }\n        return null;\n    }\n}\n\nfunction handleEntityNotFound(res) {\n    return function(entity) {\n        if(!entity) {\n            res.status(404).end();\n            return null;\n        }\n\n        return entity;\n    }\n}\n\nfunction handleError(res, statusCode) {\n    statusCode = statusCode || 500;\n    return function(err) {\n        res.status(statusCode).send(err);\n    }\n}\n\nexport function index(req, res) {\n    return Link.find()\n        .exec()\n        .then(respondWithResult(res))\n        .catch(handleError(res));\n}\n\nexport function create(req, res) {\n    const { longUrl } = req.body;\n    const baseUrl = config.get('baseUrl');\n\n    // Check base Url\n    if(!validUrl.isUri(baseUrl)) {\n        return res.status(401).json('Invalid base Url');\n    }\n\n    // Create url Code\n    const urlCode = shortid.generate();\n\n    if(validUrl.isUri(longUrl)) {\n        try {\n           return Link.findOne({ longUrl })\n                .then(linkFound => {\n                    if(linkFound) {\n                       return res.json(linkFound);\n                    }\n                    \n                    return null;\n                })\n                .then(() => {\n                    const shortUrl = `${baseUrl}/${urlCode}`;\n\n                    const url = {\n                        longUrl,\n                        shortUrl,\n                        urlCode\n                    };\n                    \n                    return Link.create(url)\n                        .then(respondWithResult(res))\n                        .catch(handleError(res));\n                });\n\n        } catch (error) {\n            res.status(401).json('Invalid long url');\n        }\n    }\n}","const mongoose = require('mongoose');\n\nvar LinkSchema = new mongoose.Schema({\n    urlCode: String,\n    longUrl: String,\n    shortUrl: String,\n}, {\n    timestamps: true\n});\n\nmodule.exports = mongoose.model('Link', LinkSchema);","","const mongoose = require('mongoose');\n\nconst User = mongoose.Schema({\n    name: String,\n    email: String,\n    username: String,\n    provider: String,\n    google: {},\n    facebook: {}\n}, {\n    timestamps: true\n});\n\nmodule.exports = mongoose.model('User', User);","","module.exports = {\n    mongo: {\n        uri: process.env.MONGOEB_URI || 'mongodb+srv://admin:admin123@cluster0-04u6e.mongodb.net/shortlinks?retryWrites=true&w=majority'\n    }\n};\n","const _ = require('lodash');\n\nconst all = {\n    env: process.env.NODE_ENV,\n    clientPort: process.env.CLIENT_PORT,\n    port: process.env.PORT || 5000,\n    baseUrl: 'http://localhost:5000',\n    secrets: {\n        session: 'documents-secret'\n    },\n    google: {\n        clientID: process.env.GOOGLE_ID || '694752243466-8dnn58v4majnii5cmb6f5tlr74bce1tu.apps.googleusercontent.com',\n        clientSecret: process.env.GOOGLE_SECRET || 'ETQd4Nxus7zDG-B_GcLes1Ui',\n        callbackURL: `${process.env.DOMAIN || ''}/auth/google/callback`\n    },\n    facebook: {\n        clientID: process.env.FACEBOOK_ID || 'id',\n        clientSecret: process.env.FACEBOOK_SECRET || 'secret',\n        callbackURL: `${process.env.DOMAIN || ''}/auth/facebook/callback`\n    },\n};\n\nmodule.exports = _.merge(\n    all,\n    require(`./${process.env.NODE_ENV || 'development'}.js`) || {}\n);\n","module.exports = {\n    mongo: {\n        uri: process.env.MONGOEB_URI\n    }\n};\n"]}